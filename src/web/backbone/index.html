<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>Â¡Palabras! - Backbone client</title>

    <link type="text/css" rel="stylesheet" href="css/main.css"/>

</head>
<body>


<div class="centered" id="main_div">

<div id="left">
<p>&nbsp;</p>
</div>

<div id="middle">


<table id="board">
<tr>
  <td class="triple_word"></td>
  <td></td>
  <td></td>
  <td class="double_letter"></td><td></td><td></td><td></td><td class="triple_word"></td><td></td><td></td><td></td><td  class="double_letter"></td><td></td><td></td><td class="triple_word"></td>
</tr>
<tr>
  <td></td>
  <td class="double_word"></td>
  <td></td>
  <td></td>
  <td></td>
  <td class="triple_letter"></td>
  <td></td>
  <td></td><td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="double_word"></td><td></td>
</tr>
<tr>
  <td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td class="double_letter"></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_word"></td><td></td><td></td>
</tr>
<tr>
  <td  class="double_letter"></td><td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_word"> </td><td></td><td></td><td  class="double_letter"></td>
</tr>
<tr>
  <td></td><td class="occupied">P</td><td class="occupied">A</td><td class="occupied">L</td><td class="double_word occupied">A</td><td class="occupied">B</td><td class="occupied">R</td><td class="occupied">A</td><td class="occupied">S</td><td class=""></td><td class="double_word"> </td><td class=""></td><td></td><td></td><td></td>
</tr>
<tr>
  <td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="triple_letter"></td><td></td><td class="occupied">M</td><td></td><td class="triple_letter"></td><td></td><td class=""></td><td></td><td class="triple_letter"></td><td></td>
</tr>
<tr>
  <td></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_letter"></td><td class="occupied">O</td><td class="double_letter"></td><td></td><td></td><td class=""></td><td class="double_letter"></td><td></td><td></td>
</tr>
<tr>
  <td class="triple_word"></td><td></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_word occupied">N</td><td class=""></td><td class=""></td><td class=""></td><td class="double_letter"></td><td></td><td></td><td class="triple_word"></td>
</tr>
<tr>
  <td></td><td></td><td class="double_letter"></td><td></td><td class="occupied">A</td><td class="occupied">M</td><td class="double_letter occupied">I</td><td class="occupied">G</td><td class="double_letter occupied">O</td><td class="occupied">S</td><td class="occupied">!</td><td></td><td class="double_letter"></td><td></td><td></td>
</tr>
<tr>
  <td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="triple_letter"></td><td ></td><td></td><td></td><td class="triple_letter"></td><td></td>
</tr>
<tr>
  <td></td><td></td><td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td></td>
</tr>
<tr>
  <td  class="double_letter"></td><td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_word"></td><td></td><td></td><td  class="double_letter"></td>
</tr>
<tr>
  <td></td><td></td><td class="double_word"></td><td></td><td></td><td></td><td class="double_letter"></td><td></td><td class="double_letter"></td><td></td><td></td><td></td><td class="double_word"></td><td></td><td></td>
</tr>
<tr>
  <td></td><td class="double_word"></td><td></td><td></td><td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="triple_letter"></td><td></td><td></td><td></td><td class="double_word"></td><td></td>
</tr>
<tr>
  <td class="triple_word"></td><td></td><td></td><td  class="double_letter"></td><td></td><td></td><td></td><td class="triple_word"></td><td></td><td></td><td></td><td  class="double_letter"></td><td></td><td></td><td class="triple_word"></td>
</tr>
</table>

</div> <!-- CLOSE MIDDLE -->



<div id="right">
</div>

</div><!-- close main -->


<script src="js/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="js/underscore-min.js" type="text/javascript"></script>
<script src="js/backbone-min.js" type="text/javascript"></script>

<script type="text/javascript">

//App
var Palabras = {
  Models: {},
  Collections: {},
  Views: {},
  Routers: {},
  initialize: function() {
    new ExampleApp.Routers.Tasks();
    Backbone.history.start();
  }
};


// Models
Palabras.Models.Player = Backbone.Model.extend();

Palabras.Models.BoardSpace = Backbone.Model.extend();

Palabras.Models.Board = Backbone.Model.extend();

Palabras.Models.Game = Backbone.Model.extend({
  url: "http://localhost/TermsWithChums/src/webapp/assets/test_new_model.json",
  defaults: {
    board_size: 15,
    num_players: 2,
    id: null
  },
  parse: function(response){
    return response;
  }
  
});


//Views
Palabras.Views.ScoresView = Backbone.View.extend({
  id: "scoreboard",
  render: function(){
    header = "<h3>Scores:</h3>";
    this.$el.append(header);
    tbl = document.createElement("table");
    for (var i=0; i < this.model.get('players').length; i++){
      player = this.model.get('players')[i];
      tr = document.createElement("tr");
      td = document.createElement("td");
      td.innerHTML = player.name;
      tr.appendChild(td);
      score = document.createElement("td");
      score.innerHTML = player.score;
      tr.appendChild(score);
      tbl.appendChild(tr)
    }
    this.$el.append(tbl);
    this.$el.html();
  }
});


Palabras.Views.CurrentPlayerView = Backbone.View.extend({
  initialize: function(){
    this.currentPlayer = this.model.get('players')[this.model.get('current_turn')];
    this.tiles = this.currentPlayer.tiles;
  },
  id: "player_move",
  events: {
    "click #shuffle_btn": "shuffleTiles",
    "click #move_btn": "submitMove"
  },
  submitMove: function(){
    move = $('#move_input').val();
    alert(move);

    /*
    $.ajax({
      type: "PUT",
      url: "api/games/{id}/move",
      data: { id: this.id, move: move, currentPlayer: this.currentPlayer }
      })
      .done(function( msg ) {
        alert( "Data Saved: " + msg );
      });
*/

  },
  shuffleTiles: function(){
    tiles = this.tiles;
    for (var i=tiles.length-1; i > 0; i--){
      j = Math.floor((Math.random()*i)+0);
      tmp = tiles[j];
      tiles[j] = tiles[i];
      tiles[i] = tmp;
    }
    this.render();
  },
  render: function(){
    tiles = this.tiles;
    var rendered = "<h5>" + this.currentPlayer.name + ", it's your move:</h5>\n<table id='tile_rack'><tr>";
    for (var i=0; i < tiles.length; i++){
      rendered += "<td>" + tiles[i].character + "<sub>" + tiles[0].points + "</sub></td>";
    }
    rendered += "</tr></table>";
    rendered += "<button id='shuffle_btn'>Shuffle tiles</button>";
    rendered += "<input id='move_input'><button id='move_btn'>Submit move</button>";
    this.$el.html(rendered);
  }
});

Palabras.Views.BoardView = Backbone.View.extend({
  id: "board",
  tagName: "table",
  render: function(){
    n = this.model.spaces.length;
    for (var i=0; i < n; i++) {
      tr = document.createElement("tr");
      for (var j=0; j < n; j++) {
        space = this.model.spaces[i][j];
        td = document.createElement("td");
        td.className = space.type;
        if (space.occupied) {
          td.innerHTML = space.value;
          td.className += (" occupied");
        }
        tr.appendChild(td);
      }
      this.$el.append(tr)
    }
    this.$el.html();
  }
});

//spaghetti
game = new Palabras.Models.Game();
currentPlayer = new Palabras.Models.Player();
board = new Palabras.Models.Board();
game.fetch({

  success: function(){

    currentPlayer = game.get('players')[game.get('current_turn')];
    board = game.get('board');
    
    scores = new Palabras.Views.ScoresView({ model: game });
    boardView = new Palabras.Views.BoardView({ model: board });
    currentPlayerView = new Palabras.Views.CurrentPlayerView({ model: game });
    
    scores.render();
    currentPlayerView.render();
    boardView.render();

    $('#middle').append(currentPlayerView.el);   
    $('#board').replaceWith(boardView.el);
    $('#right').append(scores.el);
  }
});

</script>

</body>
</html>



















